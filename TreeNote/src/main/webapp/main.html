<!doctype html>
<html lang="en"
	style="height: 100%; min-height: 780px; min-width: 992px;">
<head>
<meta charset="utf-8">
<title>Tree</title>

<!-- 라이브러리 -->

<script src="resources/js/jquery.min.js"></script>
<script src="resources/js/jquery-ui.min.js"></script>
<script src="resources/js/go.js"></script>
<script src="resources/js/bootstrap.min.js"></script>

<!-- 트리 리스트 -->

<link rel="stylesheet" href="resources/css/treeList.css">

<link rel="stylesheet" href="resources/css/jquery-ui.min.css">
<link rel="stylesheet" href="resources/css/bootstrap.css">
<link rel="stylesheet" href="resources/css/bootstrap.min.css">

<!-- 개발 부분 -->

<script src="resources/js/goImpl.js"></script>
<script src="resources/js/jQueryImpl.js"></script>
<link rel="stylesheet" href="resources/css/tree.css">

<script type="text/javascript">

</script>

<!-- 개발 부분 -->

<!-- <script>
  $(function() {
	  jqueryImpl();
  });
  
  </script> -->
</head>
<body style="height: 100%;">
	<nav class="navbar navbar-fixed-top" id="navbar"
		style="display: none;">
		<div class="container" style="padding:0px; width: 992px;background-color: #2ECC71;">
			<!-- 트리리스트부분 -->
			<div class="col-xs-4" style="padding:0px;">
				<div class="col-xs-2" style="padding:0px;">
				<img  src="resources/img/btn_treeadd.png" width="40px"
					height="40px" style="margin: 5px;">
				</div>
			<div class="templist">
				<div class="col-xs-1" style="padding:0px;">
				<img src="resources/img/btn_treelist_left.png" width="20px"
					height="40px" style="margin: 5px;">
				</div>
				<div class="col-xs-7" style="padding-top:17px; padding-right:0px; padding-left:0px; color:white; font-family:Jeju Gothic;">여기가 트리 리스트 나오는 곳</div>
				<div class="col-xs-1" style="padding:0px;">
				<img src="resources/img/btn_treelist_right.png" width="20px"
					height="40px" style="margin: 5px;">
				</div>
			</div>
			
			</div>

			<div class="col-xs-4 text-center" style="padding:0px;">
				<img src="resources/img/treenote.png" width="280px"
					height="50px" >

			</div>
			<div class="col-xs-4 text-right" style="padding:0px;">
				<img id="btn_mypage" src="resources/img/btn_mypage.png" width="30px" height="30px" style="margin:10px;">
				<img id="btn_search" src="resources/img/btn_search.png" width="30px" height="30px" style="margin:10px;"><!-- update 12/11/friday -->	
				
				
				
				<!-- 친구리스트 드롭다운 메뉴 -->
				<div style="display:inline-block" id ="friendListDrop">
					<span  class="dropdown-toggle " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" width="30px" height="30px" style="margin:10px;cursor:pointer;clear:both;z-index:100">
						
						<img id="btn_friend" src="../resources/img/btn_friend.png" style="width:30px;height:30px;" >
					</span>
					<div class="dropdown-menu dropdown-right" style="padding-top:0px; right:0px">
	                        <div class="dropdown-header list-group-item-success" style="margin-top:0px">
	                           Friend List
	                            <ul class="actions a-alt">
	                                <li><a href=""><i class="zmdi zmdi-check-all"></i></a></li>
	                            </ul>
	                        </div>
	                        <div class="list-group lg-alt" style="margin-bottom: 0px;">
	                        	<p id="friendListDropdown" style="display:none"></p> 
<!-- 	                            <div class="view-more">View more</div> -->
	                        </div>
	                    </div>
				</div>
				
<!-- 				알림창 -->
				<div style="display:inline-block" id ="alertListDrop">
					<span class="dropdown-toggle " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" width="30px" height="30px" style="margin:10px;cursor:pointer;clear:both;z-index:100">
						
						<img id="btn_alam" src="../resources/img/btn_alam.png" style="width:30px;height:30px;" >
					</span>
					<div class="dropdown-menu dropdown-right" style="padding-top:0px;right:0px">
	                        <div class="dropdown-header list-group-item-success" style="margin-top:0px">
	                           Alert List
	                            <ul class="actions a-alt">
	                                <li><a href=""><i class="zmdi zmdi-check-all"></i></a></li>
	                            </ul>
	                        </div>
	                        <div class="list-group lg-alt" style="margin-bottom: 0px;">
	                        	<p id ="alertDropdown" style="display:none"></p> 
<!-- 	                            <div class="view-more">View more</div> -->
	                        </div>
	                    </div>
				</div>
				<!---------------------------------------- -->
				
				<!---------------------------------------------------------------->
				<img id="btn_logout" src="resources/img/btn_logout.png" width="30px" height="30px" style="margin:10px;">	
			</div>
			<!--/.navbar-collapse -->
		</div>
	</nav>






	<div id="treeContainer"
		style="display: none; max-width: 992px; width: 100%; height: 100%; margin: 0 auto; background: #E4E4E4;">


		<div id="base"
			style="position: relative; width: 100%; height: 100%; float: left; padding-top: 50px; display: none;">
			<div id="myDiagram"
				style="position: relative; background: #E4E4E4; float: left; width: 100%; height: 100%"></div>

			<div id="timeline">
				<div style="position: absolute; width:70px; right:150px">
					<div id="keywordBtnTop" style="height: 105px;"></div>
				</div>
				<div style="width:190px; position: absolute; right:0px;">
					<div style="height: 65px;"></div>
					<div id="timeLineTitleBox" style="height: 40px; display:none;">
						<div id="titleImageBox">
							<div style ="width: 180px; height: 40px; margin: 0 auto; padding:5px; border-radius: 15px; background:white;">
							<img src="/resources/img/timelinetitle.png" width="170px" height="30px"style="margin:0 auto;"></div>
						</div>
					</div>
					<div id="searchBox" style="height: 40px; display:none;">
						<input type="text" id="search" class="form-control" style="width: 180px; border: 0; margin-right: 10px; border-radius: 5px;">
					</div>
					<div id="timelinec" style="overflow: hidden;">
						<div id="keywordTop" style="height: 0px;"></div>
					</div>
				</div>
			</div>

			 <div id="content" style="display: none;">
			 		<div class="col-xs-8" style="height:100%;padding:10px;">
       			<iframe src="" frameborder="0" width="100%" height="330px" marginwidth="0" marginheight="0"> </iframe>
       		</div>
       		<div class="col-xs-4" style="height:100%; padding:10px; padding-left:0px;">
       			<div style="width:100%; height:256px; background:white;"></div>
       			<div style="width:100%; height:10px;"></div>
       			<div style="width:100%; height:64px; background:white;"></div>
       		</div>
       </div>

			<div id="reply" style="display: none;"></div>

			<div id="userpage" style="display: none;"></div>

			<div id="treelist" style="display: none;">
				<div id="demo" class="showcase">
					<section id="examples">
						<!-- content -->
						<h3 id="userNo">TreeTitle</h3>
						<h3 id="treeTitle"></h3>
						<div id="content-9" class="content vertical-images">
							<ul id="treeList">
								<h2 id="count">TreeList:</h2>
								<li id="list"></li>
							</ul>
						</div>
					</section>
				</div>
			</div>

		</div>

		<!-- style="width: 200px; height: 100%; border: 2px solid #00FF00; background: #efefef; float: right; display: none; -->

	</div>

	<div id="dialog" title="Basic dialog"
		style="display: none; width: 100%;">
		<p>This is the default dialog which is useful for displaying
			information. The dialog window can be moved, resized and closed with
			the 'x' icon.</p>
	</div>
	<!-- /container -->
	<input id="inputText" type="text" class="form-control" style="display: none; width: auto; border-radius: 5px; border:0; padding-left:1px; font-family: Jeju Gothic;">


<!-- //핸들바 js파일 추가 -->
<script type="text/javascript" src="../resources/js/handlebars.min.js"></script>

<script type="text/javascript">
	$("#navbar").show("slide", {
		direction : "up"
	}, 1000);
	$("#loginContainer").css("display","none");
	$('#treeContainer').css('display','block');
	$("#timeline").delay(1000).show("slide", {
		direction : "right"
	}, 500);
	$("#base").delay(1000).show("fade", 500);
	setTimeout("goImpl()", 2000);
	

</script>


<!-- update 12/11/friday -->
<!-- 핸들바 탬플릿 -->
<script id="alertList" type="text/x-handlebars-template">
{{#each friend}}
<div class="list-group-item " href="" style="margin:0px;border:0px;{{#checkStatus requestStatus}} {{/checkStatus}}">
	<div class="pull-left"> 
		<input type="text" class="userNoLink" value="{{userNo}}" hidden>
		<img class="img-avatar "  src="{{#checkPhoto photo}}{{/checkPhoto}}" alt="" style="width:40px; height:40px; cursor:pointer">
	</div>
	  
     <div class="pull-right" >
        <img class="img-avatar declineFriend" src="../resources/img/minus3.png" alt="" style="width:40px; height:40px;cursor:pointer"">
    </div>

     <div class="pull-right" style="margin-right:10px;">
        <img class="img-avatar acceptFriend"  src="../resources/img/circle108.png" alt="" alt="" style="width:40px; height:40px; cursor:pointer" >
    </div>
	
    
    <div class="media-body" >
        <div class="list-group-item-heading" style="margin-left:7px">{{name}} </div>
        <small class="list-group-item-text c-gray" style="margin-left:7px">{{email}}</small>
    </div>
</div>
{{/each}}
</script>

<!-- update 12/11/friday -->
<script id="friendlist" type="text/x-handlebars-template">
{{#each friend}}
<div class="list-group-item " href="" style="margin:0px;border:0px;{{#checkStatus2 requestStatus}} {{/checkStatus2}}">
	<div class="pull-left"> 
		<input type="text" class="userNoLink" value="{{userNo}}" hidden>
		<img class="img-avatar" src="{{#checkPhoto photo}}{{/checkPhoto}}" alt="" alt="" style="width:40px; height:40px; cursor:pointer">
	</div>
	  
     <div class="pull-right" >
        <img class="img-avatar deletFriend" src="../resources/img/minus3.png" alt="" alt="" style="width:40px; height:40px; cursor:pointer">
    </div>

    <div class="media-body" >
        <div class="list-group-item-heading" style="margin-left:7px">{{name}} </div>
        <small class="list-group-item-text c-gray" style="margin-left:7px">{{email}}</small>
    </div>
</div>
{{/each}}
</script>



<!-- update 12/11/friday -->
<!-- //핸들바 이용 서버에서 가져온 친구 정보 입력 -->
<script type="text/javascript">
	var countAlert = 0;
	var countFriend = 0;
	
	$.getJSON('/user/listFriend', function(obj) {
		Handlebars.registerHelper( "checkStatus", function ( status ){
		    if (status != 1 )
		    {
		        return 'display: none"'
		    }
		    else
		    {
		        return ;
		    }
		});
		Handlebars.registerHelper( "checkPhoto", function ( status ){
		    if (status !=null )
		    {
		        return status
		    }
		    else
		    {
		        return '../resources/img/man.jpg';
		    }
		});
		
		Handlebars.registerHelper( "checkStatus2", function ( status ){
		    if (status != 2 )
		    {
		        return 'display: none"'
		    }
		    else
		    {
		        return ;
		    }
		});
		
		
		for(var i in obj.friend){
			if(obj.friend[i].requestStatus ==1){
				countAlert++;
			}else if( obj.friend[i].requestStatus ==2){
				countFriend++;
			}
		}
		
		$('#btn_friend').before('<span class="label label-danger" style="position: absolute;display: inline;border-radius: .25em;vertical-align: top;opacity: .5;top: 6px;margin-left: 20px">'+countFriend+'</span>');
		$('#btn_alam').before('<span class="label label-danger" style="position: absolute;display: inline;border-radius: .25em;vertical-align: top;opacity: .5;top: 6px;margin-left: 20px">'+countAlert+'</span>');
		
		
		var tr2;
		var templateSource2 = $("#friendlist").html();
		var template2 = Handlebars.compile(templateSource2);
		tr2 = template2(obj);
		//console.log(tr2);
		$('#friendListDropdown').before(tr2)
		
		
		var tr;
		var templateSource = $("#alertList").html();
		var template = Handlebars.compile(templateSource);
		tr = template(obj);
		//console.log(tr);
		$('#alertDropdown').before(tr)
		
		
		
	});

	
	//친구 수락 
	console.log("click event start")
	$(document).on('click', '.acceptFriend', function(){
		var accFriend = $(this);
		var acceptFriendNo = accFriend.parents('.list-group-item').find('.userNoLink').val();
		var acceptFriendHtml = accFriend.parents('.list-group-item')
		$.getJSON('/user/acceptFriend/'+acceptFriendNo,function(data){
			if(data){
				acceptFriendHtml.remove()
				$('#btn_friend').prev().text(++countFriend)
				$('#btn_alam').prev().text(--countAlert);
				$('#friendListDrop').find('.userNoLink[value='+acceptFriendNo+']').parents('.list-group-item').css('display','');
			}
		})
		
	})
	
	
	$(document).on('click','.deletFriend', function(){
		var delFriend = $(this);
 		var deleteFridneNo = delFriend.parents('.list-group-item').find('.userNoLink').val();
 		delFriend.parents('.list-group-item').remove();
 		$('#btn_friend').prev().text(--countFriend)
	})
	
</script>

<script id="searchListTemplate" type="text/x-handlebars-template">
{{#list}}
<div class="keywordBox" style="margin-top:15px">
<div id="{{keyword.key}}" class="keyword" style="background:{{keyword.color}};">
	<div>
		<div class="col-xs-6" style="padding: 0; margin:0;">
			{{#if parentKeyword}}
				<span id="parentKeyword" style="background: {{parentKeyword.color}};">{{parentKeyword.keyword}}
				<input type="hidden" value={{parentKeyword.key}}>
			</span>
			{{else}}
				<span id="parentKeyword" style="background:white;">최상위</span>
			{{/if}}
		</div> 
		<div class="col-xs-6 text-right" style="padding: 0; margin:0;">
			<span id="searchKeywordUser" style="">by {{user.name}}
				<input type="hidden" value={{user.userNo}}>
			</span>
		</div>
	</div>
	<div>
		<div class="col-xs-12 text-left" style="padding: 0;">
			<span id="keyword" style="font-size: 20px; font-family: Jeju Gothic; padding:2px;">{{keyword.keyword}}
				<input type="hidden" value={{keyword.key}}>
			</span>
		</div>
	</div>
	<div>
		<div class="col-xs-12 text-left" style="padding: 0; margin:0;">
			{{#setChildKeyword childKeywordList}} {{/setChildKeyword}}
		</div>
	</div>
</div>
</div>
{{/list}}
</script>

<script id="searchListBtnTemp" type="text/x-handlebars-template">
{{#list}}
<div class="timeLineBtnBox" style="margin-top:15px; display:none;">
	<div class="timeLineCopyButton" style="display:none;">
		<div style="width:2px; height:70px; display: inline-block;">C O P Y</div>
	</div>
	<div class="timeLineAddButton" style="display:none;">
		<div style="width:2px; height:70px; display: inline-block;">+ A D D</div>
	</div>
	<input name="key" type="hidden" value={{keyword.key}}>
	<input name="keyword" type="hidden" value={{keyword.keyword}}>
</div>
{{/list}}
</script>

<!-- //핸들바 이용 서버에서 가져온 친구 정보 입력 -->
<script type="text/javascript">
	$.getJSON('/user/listFriend', function(obj) {
		var tr;
		var templateSource = $("#boardTrTemplate").html();
		var template = Handlebars.compile(templateSource);

		tr = template(obj);
		console.log(tr);
		$('li[role=separator]').before(tr)
	});

	function setSearchList(data){

		Handlebars.registerHelper( "setChildKeyword", function ( childKeywordList ){
			var returnString = "";
			if(childKeywordList.length == 0){
				returnString = '<span id="childkeyword" class="childkeyword" style="background:white; display:inline; color:gray;">없음</span>'
				return returnString;
			}
			else{
				for(var i = 0 ; i < childKeywordList.length ; i++){	
			    if (i < 5)
			    {
			    	returnString += '<span class="childkeyword" style="background: '+childKeywordList[i].color+';">'+childKeywordList[i].keyword+'<input type="hidden" value="'+childKeywordList[i].key+'"></span>';
			    }
			    else if(i == 5)
			    {
			    	returnString += '<span class="childkeyword" style="background:white; width:14px;">...</span>';
			    }
			    console.log("childKeywordList : "+childKeywordList.length+"i : "+i+"");
				}
				return returnString;
			}
		});
		
		var templateSource = $("#searchListTemplate").html();
		//console.log(templateSource);
		var template = Handlebars.compile(templateSource);
		//console.log(data);
		//console.log(template);
		//console.log(template(data));
		return template(data);
	}

	function setSearchBtnList(data){
		var templateSource = $("#searchListBtnTemp").html();
		var template = Handlebars.compile(templateSource);
		return template(data);
	}

</script>



</body>
</html>
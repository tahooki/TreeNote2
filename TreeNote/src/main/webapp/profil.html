<html lang="en" style="overflow: hidden">
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>Freelancer - Start Bootstrap Theme</title>

<!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
<link href="resources/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="resources/css/profil/freelancer.css" rel="stylesheet">
<!-- owl carusel -->
<link href="resources/css/profil/owl.carousel.css" rel="stylesheet">
<link href="resources/css/profil/owl.theme.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="resources/css/profil/font-awesome/css/font-awesome.min.css" rel="stylesheet"type="text/css">
<link href="http://fonts.googleapis.com/css?family=Montserrat:400,700"
	rel="stylesheet" type="text/css">
<link
	href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"
	rel="stylesheet" type="text/css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css"></style>
<style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
	top: 18px !important;
	left: 50% !important;
	margin-left: -100px !important;
	width: 200px !important;
	border: 2px rgba(255, 255, 255, .38) solid !important;
	border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
	margin-left: 0px !important;
}

.panel-body::-webkit-scrollbar {
	display: none;
}

img.img-avatar{
	top:10px;
}

.profilNavi:hover {
	visibility: visible;
}
.owl-prev{
    position: absolute;
    left: -35px;
    top: 92px;
    width: 25px;
    word-break: break-all;
}
.owl-next{
    position: absolute;
    right: -35px;
    top: 92px;
    width: 25px;
    word-break: break-all;
}

#myDiagram{
	position:absolute;
	opcity:1;
}

#owl-demo .item {
	padding-left:1;
    margin: 0px;
    display: block;
    width: 100%;
    height: auto;
}
</style>
<style type="text/css"></style>
<style type="text/css"></style>
</head>

<body id="page-top" class="index" cz-shortcut-listen="true"
	style="overflow: hidden">

	<header style="height: 350px; float: left; width: 100%;">
			<div class="row"
				style="padding-top: 7px; padding-left: 20px; padding-right: 10px; padding-bottom: 10px; margin: 0px;font-size:14px">
				<!-- 프로필 들어가는 장소 -->
				<div class="col-sm-4 col-md-6"
					style="width: 32%; border: solid; margin-right: 13px; height: 95%; padding: 0 0 0 0;float:left">
					<div class="panel-body"
						style="height: 91%; overflow: scroll; padding-bottom: 0px; margin-top: 15px; padding-top: 0px">
						<div id="keywordList" class="list-group" style="margin-bottom: 0px">
							<!-- 키워드 리스트 들어갈 장소 -->
						</div>
					</div>
				</div>
				<div class="col-sm-4 col-md-6"
					style="width: 32%; border: solid; height: 95%; padding: 0 0 0 0;float:left">
					<div class="panel-body"
						style="height: 91%; overflow: scroll; padding-bottom: 0px; margin-top: 15px; padding-top: 0px;">
						<div id="profilFriend" class="list-group" style="margin-bottom: 0px">
							<!-- 친구리스트 들어갈 장소 -->
						</div>
					</div>
				</div>
			</div>
	</header>
	<div class="scroll-top page-scroll ">
		<a class="btn btn-primary" href="#page-top"> 
			<img class="profilNavi" src="resources/img/btn_treelist_right.png" style="width:40px;position: absolute;width: 40px;top: 36px;left: 8px;display:none">
		</a>
	</div>
	<div class="scroll-left page-scroll"  style="display:none;">
		<a class="btn btn-primary" href="#page-top">
			<img class="profilNavi" src="resources/img/btn_treelist_left.png" style="width:40px;position: absolute;width: 40px;top: 36px;lleft: 10px;left: 22px;">
		 </a>
	</div>

	<!-- Portfolio Grid Section -->

	<section id="portfolio" style="height: 350px;display:none">
		<div class="container">
			
			<div class="row" style="height: 81%;margin-top: 28px;">
				
			      <div id="demo">
			        <div class="container">
			          <div class="row">
			            <div class="span12">
			
			              <div id="owl-demo" class="owl-carousel">
			                <!-- 내 트리리스트 들어갈 장소 -->

			              </div>
			            </div>
			          </div>
			        </div>
			    </div>
   			</div>

	</section>


	<!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->



	<!-- jQuery -->
	<script src="resources/js/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="resources/js/bootstrap.min.js"></script>

	<!-- Plugin JavaScript -->
	<script
		src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
	<script src="resources/js/profil/classie.js"></script>
	<script src="resources/js/profil/cbpAnimatedHeader.js"></script>

	<!-- Contact Form JavaScript -->
	<script src="resources/js/profil/jqBootstrapValidation.js"></script>
	<script src="resources/js/profil/contact_me.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="resources/js/profil/freelancer.js"></script>

	<script src="resources/js/go.js"></script>


	<!-- owl carousel -->
    <script src="resources/js/profil/owl.carousel.js"></script>

	<!-- 트리 리스트 -->
	<!-- 핸들바스 -->
	<script type="text/javascript" src="resources/js/handlebars.min.js"></script>
	<script src="resources/js/goImpl.js"></script>
	<script src="resources/js/jQueryImpl.js"></script>
	<script type="text/javascript">
		goImpl()
	</script>
	<script type="text/javascript" src="resources/js/jqueryFileUpload/vendor/jquery.ui.widget.js"></script>
<script type="text/javascript" src="resources/js/jqueryFileUpload/jquery.fileupload.js"></script>
<script type="text/javascript" src="resources/js/jqueryFileUpload/form.js"></script>
    <script>
      
    </script>
    
    
    
<script id="profilTemp" type="text/x-handlebars-template">
<div class="col-sm-4 col-md-6" style="width: 32%; border: solid; margin-right: 13px; height: 95%; padding-top: 10px;float:left">
	<input type="file" name="file" style="display:none">
	<img id="profilImg" class="img-responsive" src="{{#if photo}}{{photo}}{{else}}resources/img/profile.png{{/if}}" alt="프로필 이미지" data-toggle="tooltip" title="수정을 원하시면 클릭해주세요!" style="cursor:pointer">

	<div class="intro-text">
		<span class="name"">{{#if name}}{{name}}{{else}}이 름{{/if}}</span> <span class="skills">{{#if email}}{{email}}{{else}}이메일{{/if}}</span><br>
		<span class="skills">{{story}}</span>
	</div>
</div>
</script>
<script id="friendlist" type="text/x-handlebars-template">
{{#each friend}}

<div  class="list-group-item " href="" style="margin:0px;border:0px;{{#checkStatus2 requestStatus}} {{/checkStatus2}};color: #000000;text-align: left">
	<div class="pull-left"> 
		<input type="text" class="userNoLink" value="{{userNo}}" hidden>
		<img class="img-avatar" src="resources/img/profile.png" alt="" alt="" style="width:40px; height:40px; cursor:pointer">
	</div>
	  
     <div class="pull-right" >
        <img class="img-avatar deletFriend" src="../resources/img/minus3.png" alt="" alt="" style="width:40px; height:40px; cursor:pointer">
    </div>

    
    <div class="media-body" >
        <div class="list-group-item-heading" style="margin-left:7px">{{name}} </div>
        <small class="list-group-item-text c-gray" style="margin-left:7px">{{email}}</small>
    </div>
</div>

{{/each}}
</script>
<script id="myKeywordList" type="text/x-handlebars-template">
{{#each keyword}}
<div class="list-group-item keyword-list" style="color:black;cursor:pointer" >{{keyword}}
	<input value="{{key}}" hidden>
</div> 
{{/each}}
</script>


<script id="myTreeList" type="text/x-handlebars-template">
{{#each subTree}}
<div class="item">
	<div class="col-sm-4 portfolio-item item ">
		<input type="text" value="{{treeNo}}" hidden>
		<a href="#portfolioModal4" class="portfolio-link" data-toggle="modal">
			<div class="caption">
				<div class="caption-content" id="myDiagram{{@index}}" style="height: 100%; top: 10px"></div>
			</div> 
			<img src="resources/img/minitree.jpeg" class="img-responsive1" alt="">
		</a>
	</div>
</div>
{{/each}}		                
</script>



<script type="text/javascript">
	$.ajax({
		url:"/user/getUser",
		contentType:"application/json",
		dataType:'json',
		success:function(data){
			console.log(data.user)
			var tr;
			var templateSource = $("#profilTemp").html();
			var template = Handlebars.compile(templateSource);
			tr = template(data.user);
			$('header .row').prepend(tr)
		}
	})
	
	
	
	$.getJSON('/user/listFriend', function(obj) {
		Handlebars.registerHelper( "checkPhoto", function ( status ){
		    if (status !=null )
		    {
		        return status
		    }
		    else
		    {
		        return 'resources/img/man.jpg';
		    }
		});
		
		Handlebars.registerHelper( "checkStatus2", function ( status ){
		    if (status != 2 )
		    {
		        return 'display: none"'
		    }
		    else
		    {
		        return ;
		    }
		});
		
		
	
		
		var tr2;
		var templateSource2 = $("#friendlist").html();
		var template2 = Handlebars.compile(templateSource2);
		tr2 = template2(obj);
		console.log(tr2);
		$('#profilFriend').append(tr2)
		
	});
	
	

    
   
    
	$.ajax({
		url:'/tree/listTree',
		contentType:"application/json",
		dataType:"json",
		success:function(data){
			var myMinitree ;
			var miniTree = $('#myTreeList').html();
			var miniTreeTemp = Handlebars.compile(miniTree);
			console.log(data.subTree)
			myMinitree = miniTreeTemp(data);
			console.log(myMinitree)
			$('#owl-demo').append(myMinitree);
			
			$("#owl-demo").owlCarousel({
		        autoPlay: false,
		        items : 3,
		        itemsDesktop : [1199,3],
		        itemsDesktopSmall : [979,3],
		        navigation:true,
		        pagination:false
		      });
			
			
			
		},
		complete:function(){
			$('#owl-demo .caption-content').on('mouseenter',function(){
				var tNo = $(this).parents('.col-sm-4.portfolio-item.item').find('input').val();
				
				var dName = $(this).attr('id')
				myTreelist(dName,tNo);
				$(this).unbind();
			})

		}
	})
	
	
	$.ajax({
		url:'/keyword/getMyKeyword',
		contentType:"application/json",
		dataType:"json",
		success:function(data){
			console.log("aaaa::::aaaa")
			console.log(data.keyword)
			var kList;
			var tempKlist = $('#myKeywordList').html();
			var kListTemplate = Handlebars.compile(tempKlist);
			kList = kListTemplate(data);
			$('#keywordList').append(kList);
			
			$('.keyword-list').on('click',function(){
				var keyno = $(this).find('input').val();
				sessionStorage.setItem("keywordNo",keyno);
				sessionStorage.setItem("keyword",$(this).text());
				$.getJSON("/content/getContent/" +keyno, function(data) {
					console.log("aaaaasaaasdfadsfsdf "+data.content);
					if(data.content==null){
						jQuery("#content",parent.document).show("fade",300).find("iframe").attr("src","../../../contents/contents.html");
						console.log("1111111 "+data.content);
					}
					else{
						jQuery("#content", parent.document).show("fade",300).find("iframe").attr("src","../../../contents/get.html");
						console.log(data.content);
					}						
				});					
			})
		}
	})
	
	$('.page-scroll').on('mouseenter',function(){
		$(this).find('.profilNavi').css('display','block');
	})
	$('.page-scroll').on('mouseleave',function(){
		$(this).find('.profilNavi').css('display','none');
	})
	
	$('.scroll-top').on('click',function(){
		$('header').css('display','none')
		$('section').css('display','block')
		$(this).css('display','none')
		$('.scroll-left').css('display','block')
	});
	
	$('.scroll-left').on('click',function(){
		$('section').css('display','none')
		$('header').css('display','block')
		$(this).css('display','none')
		$('.scroll-top').css('display','block')
	})
	
	function readURL(input) {
		if (input.files && input.files[0]) {
		    var reader = new FileReader();            
		    reader.onload = function (e) {
		        $('#profilImg').attr('src', e.target.result);
		    }
		    
		    reader.readAsDataURL(input.files[0]);
		}
 	}
 

	 
	 $(document).on('change','input[type=file]',function(){
		 readURL(this)
		
	 })
	 
	 $(document).on('click','#profilImg',function(){
		 $("input[type=file]").click()
	 })
		
	 
	 $(document).on('click','.deletFriend', function(){
		var delFriend = $(this);
 		var deleteFridneNo = delFriend.parents('.list-group-item').find('.userNoLink').val();
 		delFriend.parents('.list-group-item').remove();
 		console.log($('#btn_friend',document.parent).prev().text())
	})
	
	
	
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function myTreelist(diagramName,treeNo) {
	// if (window.goSamples) goSamples();
	//json data를 서버에서 호출후 map 생성
		var jsondata = jQuery.getJSON( '/tree/getTree/'+treeNo,function(success){

		console.log(success);
		var gojs = go.GraphObject.make; // for conciseness in defining templates
		
		myDiagram = // 아직 분석 안됨.
			gojs(go.Diagram, diagramName, // div의 이름이 "myDiagram"인 것을 찾아 설정함.
			{
				"toolManager.mouseWheelBehavior" : go.ToolManager.WheelZoom,
				//마우스 속성 설정. whillzoom으로 설정해서 줌도 되게 만듬.
				initialAutoScale : go.Diagram.Uniform, // 화면 정렬 타입
				// contentAlignment: go.Spot.Center, // 화면을 가운데로 적용해서 움직이지 않게 함.
				initialContentAlignment : go.Spot.Center, // 안에 들어있는 노드를 가운데로 정렬시킴
				layout : gojs(go.ForceDirectedLayout), // layout 종류.
				// moving and copying nodes also moves and copies their subtrees
				"commandHandler.copiesTree" : true, // for the copy command
				"commandHandler.deletesTree" : true, // for the delete command
				"draggingTool.dragsTree" : true, // dragging for both move and copy
				hasHorizontalScrollbar : false,
				hasVerticalScrollbar : false,
				allowCopy : false,
				allowUndo : false,
				allowDelete : false,
				
				
				mouseOver:function(e){
					//잠시 폐쇠
					//console.log("canvase mouseOver :: "+e);
					//myDiagram.model.removeNodeData(myDiagram.model.findNodeDataForKey(0));
				},
				click:function(e){
					//서치 풀리면 show 하게 할 예정
					if (sessionStorage.getItem('isTimeline') == 'false') {
				        //sessionStorage.setItem('isTimeline', 'false');
						setListTimeKeyword();
				    }
					jQuery("#content").hide("fade",300);
				}
			});
		
		// Define the Node template.
		// This uses a Spot Panel to position a button relative
		// to the ellipse surrounding the text.
		myDiagram.nodeTemplate = gojs(go.Node, "Spot", {
			selectionObjectName : "PANEL", // ??
			isTreeExpanded : false, // 노드의 펼쳐지는 것을 설정하는 부분. 기본이ㅏ false로 해놓으면 펼쳐지지
			// 않는다.
			isTreeLeaf : false,
			// 자식노드를 생성하지 못하게 만든다.?
			click:function(e, obj) {
				console.log("node Data : "+JSON.stringify(obj.data));
			},
			selectionChanged:function(part){
				selectKeyword = part;
				
				part.findObject("button2").visible = part.isSelected;
				if(part.isSelected){
					setBtnVisible();
				}else{
					
					setBtnUnVisible();
				}
				
			},
			mouseEnter:function(e,obj){
				console.log("mouseEnter");
			},
			doubleClick:function(e,obj){
				showContent(obj.data.key, obj.data.keyword);		
				//jQuery("#content").show("fade",300);
			}
		},
		new go.Binding("isShadowed", "isSelected").ofObject(),
        {
	          selectionAdorned: false,
	          shadowOffset: new go.Point(0, 0),
	          shadowBlur: 15,
	          shadowColor: "gray",
	    },
		// the node's outer shape, which will surround the text
		gojs(go.Panel, "Auto", {
				name : "PANEL"
			}, 
			gojs(go.Shape, "Circle", // 노드의 모양을 정함.
			{
				fill : "whitesmoke",
				stroke : "black",
				strokeWidth : 0,
			}, // 기본색이 whitsmoke 인듯... stroke는
			new go.Binding("fill", "color")), gojs(go.TextBlock, {	
				font : "15pt Jeju Gothic",
				stroke : "black",
				editable : true,
				margin : 2,
				textAlign: "center",
				isMultiline : false,
				wrap: go.TextBlock.WrapFit
			}, // 폰트, margin, 텍스트 박스 수정가능을 설정.
			new go.Binding("text", "keyword"))// 노드에 표시되는 텍스트를 data에서 선택하는부분.. data의
				// property중 name이라는 것을 선택.
		),
		gojs(go.Picture, {
			name: "button2",
			alignment : go.Spot.TopRight,
			maxSize : new go.Size(20, 20),
			source : "resources/img/btn_expanded.png",
			visible : false,
			click : function(e, obj) {
				// openDialog();
				if(obj.part.isTreeExpanded){
					obj.source = "resources/img/btn_expanded.png";
					obj.part.isTreeExpanded = false;
					obj.part.data.collapse = 0;
					updateKeyword(obj.part.data);
				}else{
					var child = obj.part.findTreeChildrenNodes();
					//console.log("child count??"+ child);
					if(child.count == 0){
						listOnwerChildKeyword(obj.part);
						obj.part.data.copyNo = obj.part.data.key;
					}
					obj.source = "resources/img/btn_collapse.png";
					obj.part.isTreeExpanded = true;
					obj.part.data.collapse = 1;
					updateKeyword(obj.part.data);
				}
			}
		})
		
	); // end Node

		myDiagram.linkTemplate =
		      gojs(go.Link,  // the whole link panel
		        new go.Binding("points").makeTwoWay(),
		        { curve: go.Link.Bezier, toShortLength: 15 },
		        new go.Binding("curviness", "curviness"),
		        gojs(go.Shape,  // the link shape
		          { stroke: "#2F4F4F", strokeWidth: 2.5 }),
		        gojs(go.Shape,  // the arrowhead
		          { toArrow: "kite", fill: "#2F4F4F", stroke: null, scale: 2 })
		    );
		
		// create the model with a root node data
		myDiagram.model = new go.TreeModel([ // 트리모델로 설정
	     {
	    	 key : 0,
	    	 keyword : "로그아웃 되었습니다.",
	    	 color : "#2ECC71",
	    	 collapse : 0
	     } // 초기 토드 추가
	     ]);

		myDiagram.layoutDiagram(true);

		myDiagram.model = go.Model.fromJson(success.Tree)
		
		// console.log(myDiagram.model);
		allExpanded();
	})
	
}
	

</script>




</body>
</html>
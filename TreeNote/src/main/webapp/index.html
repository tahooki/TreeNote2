<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>Insert title here</title>
<link rel="stylesheet"href="resources/css/blue.css">
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="resources/css/alertModal.css">

<!-- <link href="//fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet" type="text/css"/> -->
<link href="resources/css/main.css" rel="stylesheet" type="text/css"/>
<link href="resources/css/jquery.Jcrop.min.css" rel="stylesheet" type="text/css"/>
<style type="text/css">

</style>
</head>


<body cz-shortcut-listen="true">
<div id="wrapper" >
  <div id="container">
	<section class="tabs">
		<input id="tab-1" type="radio" name="radio-set" class="tab-selector-2" checked="checked">
		<span for="tab-1" class="tab-label-1">Login</span>


		<input id="tab-2" type="radio" name="radio-set" class="tab-selector-1" >
		<span for="tab-2" class="tab-label-2">Signup</span>
	
		<div class="clear-shadow"></div>
		
		<div id="content">
			<div class="content-2">
				<form id="loginaction" action="/user/login" method="post"  >
				  <p>
					<input class="field" name="email" required="required" type="email" placeholder="Name or Email">
				  </p>
				  <p>
					<input class="field" name="password" required="required" type="password" placeholder="Password">
				  </p>
				  
				  <p>
				  	<div id="loginbutton" style="clear:both; opacity: 1;position: relative; float: left; background-color: #449D44; border-radius: 3px; width: 99%;
				  	text-align: center; font-size:x-large; height: 24px;cursor:pointer; ">SIGN IN</div>
				  </p>
				  <p>
				  	<div id="fLoginbutton" style="clear:both; opacity: 1;position: relative; float: left; background-color: #3A5795; border-radius: 3px; width: 100%;
				  	text-align: center; font-size:x-large; height: 24px;color:white;padding-bottom: 4px;padding-top: 4px; cursor:pointer;">facebook</div>
				  </p>
				</form>
			</div>
			
			
<!--///////////////////////////////////////////////////////////////////////////////////////////////////////////////////  -->				 	
			
	<div id="popup" class="popup" style="display: none;">
		<div class="popup__body"><div class="js-img"></div></div>
		<div style="margin: 0 0 5px; text-align: center;">
			<div class="js-upload btn btn_browse btn_browse_small">Upload</div>
		</div>
	</div>
			
			
			<div class="content-1">
				<form id="signUpForm" enctype="multipart/form-data" >
				 	
				 	
<!--///////////////////////////////////////////////////////////////////////////////////////////////////////////////////  -->				 	
		    <div class="content">
		       <div class="example">
			       <div class="example__left" style=" position:relative;"  >
						<div id="userpic" class="userpic"  >
							<div class="js-preview userpic__preview" ></div>
							<div class="btn btn-success js-fileapi-wrapper" style="position:relative;">
								<div class="js-browse" style="position:relative;">
									<span class="btn-txt" style="position:relative;margin:0px;">IMAGE</span>
									<input type="file" name="filedata" style="z-index:5"/>
								</div>
								<div class="js-upload" style="display: none;">
									<div class="progress progress-success" style="position:relative;"><div class="js-progress bar" style="position:relative;"></div></div>
									<span class="btn-txt">Uploading</span>
								</div>
							</div>
						</div>
					</div>
				</div>	
			</div>

<!--///////////////////////////////////////////////////////////////////////////////////////////////////////////////////  -->				 	
				 	
				 	
				 	
				 	
				  <p>
					<input class="field" name="name" required="required" type="text" placeholder="Your Name">
				  </p> 
				  <p>
					<input class="field" name="email" required="required" type="email" placeholder="Email">
				  </p>
				  <p>
					<input id="passwordprogress" class="field" name="password" required="required" type="password" placeholder="Password">
					<span class="progress" style="height: 4px; width:100%; position:relative;background-color:white;padding:0px;border-radius:2px;margin-top:2px">
						<span id="passwordProgressBar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%;height: 4px ;opacity:1;margin:0px;padding:0px;"></span>
					</span>
				  </p>
				  	
				  <p>
					<input class="field"  name="passwordCheck" required="required" type="password" placeholder="Confirm Password">
				  </p>
				  <p class="signin button">
					<input type="checkbox" required="required"> I agree with terms and conditions 
				  </p>
				  <p>
				  	<div id="signUpButton" style="clear:both; opacity: 1;position: relative; float: left; background-color: #449D44; border-radius: 3px; width: 100%;
				  	text-align: center; font-size:x-large; height: 24px;color:white;padding-bottom: 4px;padding-top: 4px; cursor:pointer;">SIGN UP</div>
				  </p>
				  <p>
				  	
				  	<div id="facebookSignup" style="clear:both; opacity: 1;position: relative; float: left; background-color: #3A5795; border-radius: 3px; width: 100%;
				  	text-align: center; font-size:x-large; height: 24px;color:white;padding-bottom: 4px;padding-top: 4px; cursor:pointer;">facebook</div>
				  </p>
				</form>
			</div>
			
			
			
		</div>
	</section>
  </div>
</div>
<script src="resources/js/jquery.min.js"></script>
<!-- <script type="text/javascript" src="../resources/js/facebookLogin.js"></script> -->




<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body">
        <p>Some text in the modal.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<div id="myModal2" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">alert</h4>
      </div>
      <div class="modal-body">
        <p>아이디와 비밀번호가 일치 하지 않음</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>









<script type="text/javascript">
	//Ajax form 전송용 함수
	function getFormData($form){
	    var unindexed_array = $form.serializeArray();
	    var indexed_array = {};

	    $.map(unindexed_array, function(n, i){
	        indexed_array[n["name"]] = n["value"];
	    });

	    return indexed_array;
	}
	
	
//로그인 버튼
$("#loginbutton").click(function() {
	var str = $('#loginaction')
	var user = getFormData(str)
	$.ajax({
		  type: 'POST',
		  url: '/user/login',
		  data: JSON.stringify(user),
		  contentType : 'application/json; charset=utf-8',
		  success : function(data){
			  console.log(data)
			  console.log(data.success);
				if(data.boolean){
						 self.location="/main.html" 
						 if (window.sessionStorage) {
							 sessionStorage.setItem('userNo', data.user.userNo);
               sessionStorage.setItem('editTreeNo', data.user.editTreeNo);
               //var position = sessionStorage.getItem('저장된 이름');
             }
				}else{
					$("#signUpForm p input[name=name]").attr('data-toggle','modal').attr('data-target','#myModal2');
					$("#signUpForm p input[name=name]").click()
					$("#signUpForm p input[name=name]").removeAttr('data-toggle').removeAttr('data-target')
					$('.field').val('');
				}
		  },
		  dataType: "json"
		});
	
	
})

var checkEmail =false;
var checkPassword = false;
var checkName = false;

//name check
$('#signUpForm p input[name=name]').on('focusout',function(){
	if($('#signUpForm p input[name=name]').val()!=""){
		checkName = true;
	}else{
		checkName = false;
	}
})

$('#signUpForm p input[name=passwordCheck]').on('focusout',function(){
	if($('#signUpForm p input[name=password]').val() !=$('#signUpForm p input[name=passwordCheck]').val()){
		$('#signUpForm p input[name=passwordCheck]').css('border-color','red')
		checkPassword = false;
	}else{
		checkPassword = true;
	}
})

$('#signUpForm p input[name=passwordCheck]').on('focusin',function(){
	$('#signUpForm p input[name=passwordCheck]').css('border-color','rgb(85, 85, 85)')
})



//회원가입 버튼 
$('#signUpButton').on('click',function(){
	var str = $('#signUpForm')
	var user = new FormData(str);
	var formuser = getFormData(str)
	
	if(checkEmail&&checkPassword&&checkName){
		$('#signUpForm').attr('action','/user/addUser').attr('method','post').submit();
		
		
// 		/* $.ajax({
// 			  type: 'POST',
// 			  url: '/user/addUser',
// 			  data: {user:user,filedata:$('.userpic').files},
// // 			  contentType : 'application/json',
// 			  contentType : 'multipart/form-data',
//  			  processData: false,
// //               contentType: false,
// 			  success : function(data){
// 				  //controller 에서 db에 데이터 정상적으로 입력시만 true값 내려오게 변경 할것
// 				  if(data.boolean){
// 					 self.location="/main.html" 
// 				}
// 				  console.log(data)
// 				  console.log(data.success);
// 					if(true){
// 						 self.location="/main.html";
// 					}else{
// 						$('#exampleInputEmail1').val('');
// 						$('#exampleInputPassword1').val('');
// 					}
// 			  },
// 			  dataType: "text"
// 			}); */
	}else{
		$("#signUpForm p input[name=name]").attr('data-toggle','modal').attr('data-target','#myModal');
		$("#signUpForm p input[name=name]").click()
		$("#signUpForm p input[name=name]").removeAttr('data-toggle').removeAttr('data-target')
	}	

}).on()




//중복 이메일 체크 
$('#signUpForm p input[name=email]').on('focusout',function(){
	var temp = $('#signUpForm p input[name=email]').val()
	var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
	$('#appendmessage').remove();
	if (re.test(temp) ){  
		
			$.ajax({
				type:'post',
				url:'/user/checkDuplication',
				contentType : 'application/json',
				data:temp,
				dataType : 'json',
				success : function(data){
					
					if(data.boolean){
						$('#signUpForm p input[name=email]').after('<p id="appendmessage" class="signin button" style="color:red; ">이미 가입된 이메일 입니다.</p>')
						checkEmail = false;
					}else{
						$('#signUpForm p input[name=email]').after('<p id="appendmessage" class="signin button" >사용 가능한 이메일 입니다.</p>')
						checkEmail=true;
					}
				}
			})
  } else if(temp==""){
	  
  }	else{
	  
	  $('#signUpForm p input[name=email]').after('<p id="appendmessage" class="signin button" style="color:red;" >올바른 양식이 아닙니다..</p>')
  } 
	
	

})



</script>
<script type="text/javascript" src="resources/js/common-passwords.js"></script>
<script type="text/javascript">
	
	//패스워드 강도 체크
	$(function(){
		
		function isCommon(pass){
			return ~window.commonPasswords.indexOf(pass);
		}

		function bruteMagnitude(pass) {
	        var sets = [
	            { regex: /\d/g, size: 10 },
	            { regex: /[a-z]/g, size: 26 },
	            { regex: /[A-Z]/g, size: 26 },
	            { regex: /[!-/:-?\[-`{-}]/g, size: 24 },
	        ];
	        var passlen = pass.length,
	            szSet = 0;

	        sets.forEach(function(set) {
	            if (set.regex.test(pass)) {
	                szSet += set.size;
	                pass = pass.replace(set.regex, '');
	            }
	        });
	        // other (unicode) characters
	        if (pass.length) szSet += 20;
	        return passlen * Math.log(szSet) / Math.log(10);
    	}

		var strengths = ['transparent','red', '#fa00ff', '#6a00ff', '#0800ff', '#00a1ff', '#00ffa5','#00ff48']

		function strength(pass) {
	        if (isCommon(pass) || !pass.length) return 0;
	        var str = bruteMagnitude(pass);
	        return str < 1 ? 0
	        	 :str < 7  ? 1 // very poor
	             : str < 9  ? 2 // poor      - 10 million - 1 billion
	             : str < 11 ? 3 // passing   - 1 billion - 100 billion
	             : str < 13 ? 4 // fair      - 100 billion - 10 trillion
	             : str < 15 ? 5 // good      - 10 trillion - 1 quadrillion
	             : str < 17 ? 6 // very good - 1-100 quadrillion
	             : 7;           // excellent - over 100 quadrillion
  		 }

		$('#passwordprogress').on('keyup keypress', function(){
			var pstrength = strength($(this).val());
			$('#passwordProgressBar').css('background-color',strengths[pstrength]).attr('aria-valuenow',100*(pstrength)/7).css('width',100*(pstrength)/7+"%")
			
		})

	})
</script>
<!--파일 업로드  -->
<!--  //////////////////////////////////////////-->
	<script>!window.jQuery && document.write('<script src="/js/jquery.dev.js"><'+'/script>');</script>

	<script src="//yandex.st/highlightjs/7.2/highlight.min.js"></script>
	<script src="//yandex.st/jquery/easing/1.3/jquery.easing.min.js"></script>


	<script>
		var FileAPI = {
			  debug: true
			, media: true
			, staticPath: './FileAPI/'
		};
	</script>



	<script src="resources/js/FileAPI/FileAPI.min.js"></script>
	<script src="resources/js/FileAPI/FileAPI.exif.js"></script>
	<script src="resources/js/FileAPI/jquery.fileapi.js"></script>
	<script src="resources/js/FileAPI/jquery.Jcrop.min.js"></script>
	<script src="resources/js/FileAPI/jquery.modal.js"></script>
				
<script>
var examples = [];
	examples.push(function (){
		$('#userpic').fileapi({
			url: '/user',
			accept: 'image/*',
			imageSize: { minWidth: 100, minHeight: 100 },
			autoUpload:true,
			maxSize : FileAPI.MB*10,
			paramName: 'filedata',
			elements: {
				active: { show: '.js-upload', hide: '.js-browse' },
				preview: {
					el: '.js-preview',
					width: 200,
					height: 200
				},
				progress: '.js-progress'
			},
			onSelect: function (evt, ui){
				var file = ui.files[0];

				if( !FileAPI.support.transform ) {
					alert('Your browser does not support Flash :(');
				}
				else if( file ){
					$('#popup').modal({
						closeOnEsc: true,
						closeOnOverlayClick: false,
						onOpen: function (overlay){
							$(overlay).on('click', '.js-upload', function (){
								$.modal().close();
								$('#userpic').fileapi('upload');
							});

							$('.js-img', overlay).cropper({
								file: file,
								bgColor: '#fff',
								maxSize: [$(window).width()-100, $(window).height()-100],
								minSize: [100, 100],
								selection: '100%',
								onSelect: function (coords){
									$('#userpic').fileapi('crop', file, coords);
								}
							});
						}
					}).open();
				}
			}
		});
	});

		
		
		
</script>


<script>
		jQuery(function ($){
			var $blind = $('.splash__blind');

			$('.splash')
				.mouseenter(function (){
					$('.splash__blind', this)
						.animate({ top: -10 }, 'fast', 'easeInQuad')
						.animate({ top: 0 }, 'slow', 'easeOutBounce')
					;
				})
				.click(function (){
					if( !FileAPI.support.media ){
						$blind.animate({ top: -$(this).height() }, 'slow', 'easeOutQuart');
					}

					FileAPI.Camera.publish($('.splash__cam'), function (err, cam){
						if( err ){
							alert("Unfortunately, your browser does not support webcam.");
						} else {
							$('.splash').off();
							$blind.animate({ top: -$(this).height() }, 'slow', 'easeOutQuart');
						}
					});
				})
			;




			$('body').on('click', '[data-tab]', function (evt){
				evt.preventDefault();

				var el = evt.currentTarget;
				var tab = $.attr(el, 'data-tab');
				var $example = $(el).closest('.example');

				$example
					.find('[data-tab]')
						.removeClass('active')
						.filter('[data-tab="'+tab+'"]')
							.addClass('active')
							.end()
						.end()
					.find('[data-code]')
						.hide()
						.filter('[data-code="'+tab+'"]').show()
				;
			});


			

			// Init examples
			FileAPI.each(examples, function (fn){
				fn();
			});
		});
	</script>
<!--  //////////////////////////////////////////-->
<script type="text/javascript" src="resources/js/facebookLogin.js"></script>
<script type="text/javascript">
 $('#facebookSignup').on('click',function(){
	 signup()
 });
</script>


</body>
</html>